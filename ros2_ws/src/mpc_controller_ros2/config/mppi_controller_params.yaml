controller_server:
  ros__parameters:
    controller_frequency: 20.0
    min_x_velocity_threshold: 0.001
    min_y_velocity_threshold: 0.5
    min_theta_velocity_threshold: 0.001
    progress_checker_plugin: "progress_checker"
    goal_checker_plugins: ["goal_checker"]
    controller_plugins: ["FollowPath"]

    # Progress checker
    progress_checker:
      plugin: "nav2_controller::SimpleProgressChecker"
      required_movement_radius: 0.5
      movement_time_allowance: 10.0

    # Goal checker
    goal_checker:
      plugin: "nav2_controller::SimpleGoalChecker"
      xy_goal_tolerance: 0.1
      yaw_goal_tolerance: 0.1
      stateful: True

    # MPPI Controller
    FollowPath:
      plugin: "mpc_controller_ros2::MPPIControllerPlugin"

      # Prediction horizon
      N: 30                    # Number of timesteps
      dt: 0.1                  # Time step (s)

      # Sampling
      K: 1024                  # Number of samples
      lambda: 10.0             # Temperature parameter

      # Noise parameters
      noise_sigma_v: 0.5       # Linear velocity noise std dev (m/s)
      noise_sigma_omega: 0.5   # Angular velocity noise std dev (rad/s)

      # Control limits
      v_max: 1.0               # Maximum linear velocity (m/s)
      v_min: -0.5              # Minimum linear velocity (m/s)
      omega_max: 1.0           # Maximum angular velocity (rad/s)
      omega_min: -1.0          # Minimum angular velocity (rad/s)

      # State tracking cost weights (Q)
      Q_x: 10.0                # X position weight
      Q_y: 10.0                # Y position weight
      Q_theta: 1.0             # Orientation weight

      # Terminal cost weights (Qf)
      Qf_x: 20.0               # Terminal X weight (2 * Q_x)
      Qf_y: 20.0               # Terminal Y weight (2 * Q_y)
      Qf_theta: 2.0            # Terminal orientation weight (2 * Q_theta)

      # Control effort weights (R)
      R_v: 0.1                 # Linear velocity effort
      R_omega: 0.1             # Angular velocity effort

      # Control rate weights (R_rate)
      R_rate_v: 1.0            # Linear velocity rate
      R_rate_omega: 1.0        # Angular velocity rate

      # Obstacle avoidance
      obstacle_weight: 100.0   # Obstacle cost weight
      safety_distance: 0.5     # Safety distance (m)
